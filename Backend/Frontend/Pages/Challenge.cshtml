@page
@model Frontend.Pages.ChallengeModel
@{
}

@if(TempData["TestResult"] != null)
{
    <script>
        alert('@TempData["TestResult"]');
    </script>
}
<style>

    .grid-container-element {
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-gap: 20px;
        border: 0px solid black;
        width: 100%;
    }

    .grid-child-element {
        margin: 10px;
        border: 0px solid red;
    }

</style>


<form id="challengeForm" asp-action="Challenge" method="post">
<div style="display: flex; justify-content: space-between; align-items: flex-start; padding: 20px;">

    <!-- Python Editor -->
    <div style="flex:1; max-width: 100%;">
            <div class="grid-container-element">
                <div class="grid-child-element">
        <textarea id="pythonCode" asp-for="Code" style="width: 100%; height: 400px;">
        </textarea>
                </div>
           <div class ="grid-child-element">
               <div class="text-center">
                        <label style="font-size:large;"> <b> Description </b> </label>
                        <br/>
                        <a>@Model.Description</a>
            <br />
                        <br />
                        <br />
        <button name="validate" value="validate" onclick="validateCode()">Validate</button>
                    </div>
            </div>
        </div>
    </div>

    </div>

    <!-- Input and Buttons -->
    <div style="flex: 1; max-width: 25%; margin-left: 20px;">
        <label for="inputText">Input:</label>
        <input asp-for="TestInput" type="text" id="inputText" style="width: 100%; margin-bottom: 10px;">
            <button name="test" value="test" onclick="runTest()">Run Test</button>
        <button name="put_word_on_tape_button" value="put_word_on_tape_button" onclick="put_word_on_tape()">start_steps</button>
        <button name="next_step_button" value="next_step_button" onclick="next_step()">next_step</button>
    </div>
    <div></div>
    <div></div>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 100px;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        .readonly-input {
            border: none;
            background-color: transparent;
            width: 100%;
            text-align: center;
        }

        td:first-child {
            position: relative;
        }

            td.triangle {
                content: '';
                position: absolute;
                top: -50px; /* Adjust as needed */
                left: 50%;
                width: 0;
                height: 0;
                border-left: 50px solid transparent;
                border-right: 50px solid transparent;
                border-bottom: 50px solid red; /* Triangle color */
                transform: translateX(-50%) rotate(180deg);
            }
    </style>
    <table id="myTable">
            <tr>
            @for (int i = 0; i < 20; i++)
            {
                <td>
                    <div class="triangle"></div>
                <input asp-for="MyArray[i] " class="readonly-input" readonly />
                    </td>
            }
            </tr>
        </table>
    
    </form>



<script>
    function runTest() {
        var pythonCode = document.getElementById('pythonCode').value;
        var inputText = document.getElementById('inputText').value;

        // Perform logic to run the test with the provided Python code and input
        // You can use AJAX to send the Python code and input to the server for execution

        // For demonstration purposes, an alert is shown
        alert('Running test...\nPython Code:\n' + pythonCode + '\nInput Text: ' + inputText);
    }

    function validateCode() {
        var pythonCode = document.getElementById('pythonCode').value;

        // Perform logic to validate the Python code
        // You can use AJAX to send the Python code to the server for validation

        // For demonstration purposes, an alert is shown
        alert('Validating code...\nPython Code:\n' + pythonCode);
    }

    function put_word_on_tape() {
    
     
        // puts the string from input test on the tape of turing machine
        var table = document.getElementById('myTable');
        var inputText = document.getElementById('inputText');
        console.log(typeof inputText.value);
        console.log(inputText.value.length);
        for (var i = 0; i < inputText.value.length; i++) {
            
            var cell = table.rows[0].cells[i];
            var input = cell.querySelector('.readonly-input');
            if (input) {
                input.value = inputText.value[i]
            }
        }     
       
    }
    function next_step() {
        event.preventDefault();
        var pythonCode = document.getElementById('pythonCode').value;
        var helper_1 = pythonCode.indexOf("initial_state = "); // helper_1 helps me find index of initial_state =
        var sub_string_of_python_code = pythonCode.substring(helper_1 + 17); //sub_string_of_python_code is the initial_state and the whole string after wards
        var last_geresh_index = sub_string_of_python_code.indexOf("'");//this helps me find the length of init state
        var init_state = sub_string_of_python_code.substring(0, last_geresh_index); // this gives me the init state
        console.log(init_state);
        var current_index = 0;
        var table = document.getElementById('myTable');
        for (var i = 0; i < 20; i++) {
            var triangle = cell.querySelector('.triangle');
            var cell = table.rows[0].cells[i];
            var input = cell.querySelector('.readonly-input');
            if (input) {
                if (input.value == 0) {
                    var nextCell = table.rows[0].cells[i + 1];
                    var nextTriangle = nextCell.querySelector('.triangle');

                    // Remove the triangle from the current cell
                    triangle.style.display = 'none';
                    console.log("my dick");

                }
            }



        }
    }


</script>